@* File: Views/Loads/_LoadRow.cshtml *@
@model LoadTrackerWeb.Models.LoadRowViewModel
@{
    bool canEdit = (ViewData["CanEdit"] as bool?) == true;

    var probillRaw = (Model.Probill ?? "").Trim();
    // Remove leading letter(s) and leading zeros (view-only)
    var probillDisplay = System.Text.RegularExpressions.Regex.Replace(probillRaw, @"^[A-Za-z]+0*", "");
}

<tr data-rowid="@Model.DetailLineId"
    data-orig-ex="@(Model.Exception ? "1" : "0")"
    data-orig-userdelay="@(Model.UserNonCarrierDelay ?? "")"
    data-effective-delay="@(Model.NonCarrierDelay ?? "")"
    data-orig-comments="@(Model.Comments ?? "")">

    <td data-col="probill">@probillDisplay</td>
    <td data-col="bol">@Model.BolNo</td>
    <td data-col="order">@Model.OrderNo</td>
    <td data-col="po">@Model.PoNo</td>

    <td data-col="receiver">@Model.Receiver</td>
    <td data-col="rcity">@Model.ReceiverCity</td>
    <td data-col="rprov">@Model.ReceiverProv</td>

    <td data-col="pickup">@Model.ActualPickup?.ToString("yyyy-MM-dd")</td>
    <td data-col="rad">@Model.RadText</td>

    <td data-col="status" class="yellow">@Model.CurrentStatus</td>

    <td data-col="ddate">@Model.DeliveryDateText</td>
    <td data-col="dtime">@Model.DeliveryTimeText</td>

    <td data-col="exception">
        @if (canEdit)
        {
            <span class="ex-text">@(Model.Exception ? "YES" : "NO")</span>
            <input type="checkbox" class="ex edit-only" @(Model.Exception ? "checked" : "") />
        }
        else
        {
            @(Model.Exception ? "YES" : "NO")
        }
    </td>

    <td data-col="ontime">@Model.OnTimeText</td>

    <td data-col="delay" class="wrap">
        @if (canEdit)
        {
            // Show EFFECTIVE delay (NonCarrierDelay) so user can correct without retyping.
            <textarea class="delay edit-lock" maxlength="255" readonly>@(Model.NonCarrierDelay ?? "")</textarea>
        }
        else
        {
            @Model.NonCarrierDelay
        }
    </td>

    <td data-col="comments" class="wrap">
        @if (canEdit)
        {
            <textarea class="comments edit-lock" maxlength="300" readonly>@(Model.Comments ?? "")</textarea>
        }
        else
        {
            @Model.Comments
        }
    </td>
</tr>
